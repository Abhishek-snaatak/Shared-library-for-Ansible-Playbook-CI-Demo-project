
@Library('ansible-PB-CD-shared-lib') _


pipeline {
    agent any

    environment {
        ENVIRONMENT = 'prod' // dev, staging, prod
        PLAYBOOK = 'playbooks/site.yml'
        INVENTORY = "inventory/${ENVIRONMENT}.ini"
    }

    stages {

        stage('Checkout SCM') {
            steps {
                git url: 'https://github.com/Abhishek-snaatak/Shared-library-for-Ansible-Playbook-CI-Demo-project.git', branch: 'main'
            }
        }

        stage('Run Ansible CD') {
            steps {
                ansibleCD(
                    playbook: env.PLAYBOOK,
                    inventory: env.INVENTORY,
                    env: env.ENVIRONMENT
                )
            }
        }
    }

    post {
        always {
            echo "Pipeline finished for ${ENVIRONMENT}"
        }
    }
}
